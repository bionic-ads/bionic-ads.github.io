<style>
    
/*
        .location {
            display: none;
        }
        
        .mediaplan.fixedTable .mediaPlanFirstColumnHeader th, .mediaplan.fixedTable .table tr th {
            border-top: 1px solid #cfcfcf;
        }
        
        .mediaplan.fixedTable .group {
            display: none;
        }
        .mediaplan.fixedTable .mediaPlanFirstColumnHeader th{
            height: 30px;
            padding: 0 0 0  5px !important;
        }
        
        .mediaplan.fixedTable .mediaPlanFirstColumnHeader th.col-line-number span{
            padding: 0;
        }
        .mediaplan.fixedTable table th .col-placement-name {
            padding: 0 0 0 5px !important;
        }
        
        .mediaplan.fixedTable .fixedtable-sidebar, .mediaplan.fixedTable .fixedtable-body {
            height: calc(100vh - 263px);
        }
*/

        .mediaplan.fixedTable .fixedtable-sidebar, .mediaplan.fixedTable .fixedtable-body {
            height: calc(100vh - 316px);
        }

.col-media-authorization {
    display: none !important;
}

.fixedTable-body::-webkit-scrollbar {
    height: 30px;
/*     width: 50px; */
    background-color: #eee;
    border: 0px solid #cfcfcf;
    padding: 2px;
}

.fixedTable-body::-webkit-scrollbar-thumb {
    background-color: #c1c1c1;
    border-radius: 3px;
    display: block;
    -webkit-border-radius: 2px;
    box-sizing: border-box;
    margin: 2px;
    height: 20px;
    border: 3px solid #eee;
}

</style>

<div class="bionic-campaign-header bionic-header block fullwidth">
                
    <h1 id="campaignname" style="font-size: 24px">...</h1>
    <span class="bionic-campaign-summary block fullwidth"><span id="campaignStartDate">...</span> - <span id="campaignEndDate">...</span> 
        <span class="divider">|</span> $ <span id="campaignBudget">...</span> budget 
<!--         <span class="authorize">Not Yet Approved</span> -->
        <span class="divider">|</span> $ <span id="campaignPlanned">...</span> in plan
    </span>
    
    <script type="text/template" class="campaignNav">

    	<ul class="bionic-tab-menu">
    		<% _.each( bionic.campaignNavItems, function( campaignNavItem ){ %>
            <% 
                var url = window.location.href;
                var theID = url.substring(url.lastIndexOf('/') + 1);
                var directory = url.substring(url.lastIndexOf('#/campaign/'));
                var group = campaignNavItem.group;
                var notification = '';
                if (window.location.hash.substr(1,18) == campaignNavItem.page.substr(1,18)){ var currentnav = 'class="current"'; } 
                if ( campaignNavItem.name == "Media Plan") {
<!--                     campaignNavItem.notification = '<i class="fa fa-paper-plane"></i>'; -->
                }
            %>
    			<li>
    				<a <%= currentnav %> href="<%- campaignNavItem.page %>"><%- campaignNavItem.name %> <%= campaignNavItem.notification %></a>
    			</li>
    
    		<% }); %>
    	</ul>   
    	 
	</script>
	
</div>


<div class="nxm-menu-bar nxm-menu-filters" style="margin-right: 0px; margin-top: 5px;">
    <div class="filter-section filter-search-master">
    <input type="text" placeholder="Search" value="" required="" id="advertisers-filter-search-master" class="filter-search-master nxm-bg-search" autofocus="" style="width: 180px;">
    <span id="clear-search" class="clear-search-filter">
        <i class="fa fa-times-circle"></i>
    </span>
    </div>
</div>

<ul class="bionic-action-menu media-plan what-you-see block" style="z-index: 4; width: 800px; padding-left: 0px;">
    <li><a class="hasDropdown bionic-mode-menu"><i class="fa fa-table"></i><span>View</span><i style="color: #9b9b9b; margin-right: 0px;" class="fa fa-caret-down"></i> <i class="fa fa-times-circle" style="display: none;"></i></a>
            <div class="menu view-menu" style="width: 200px">
                <div class="header filter-section filter-search-master">
                    <input type="text" placeholder="Search" value="" required="" id="filter-search-master" class="filter-search-master nxm-bg-search" autofocus="" style="">
                    <span id="clear-search" class="clear-search-filter">
                        <i class="fa fa-times-circle"></i>
                    </span>
                </div>
                <ul>
                    <li><a>All Columns</a></li>
                    <li><a class="mode" data-rel="mediaAuthorization">Media Authorization</a></li>
                    <li><a>Performance & KPIs</a></li>
                    <li><a>Task Management</a></li>
                </ul>
<!--                 <div class="footer"><a><i class="fa fa-expand"></i>Enter Fullscreen...</a></div> -->
<!--
                <div class="footer"><a>Save Current View...</a></div>
                <div class="footer"><a>Delete Current View</a></div>
-->
            </div>
    </li>
    <li><a class="bionic-columns-menu open-modal" rel="modal:open" href="templates/modals/columns/columns.html"><i class="fa fa-bars fa-rotate-90"></i>Columns<i class="fa fa-times-circle" style="display: none;"></i></a></li>
    <li><a class="bionic-filters-menu open-modal" rel="modal:open" href="templates/modals/filter/filter-choose-fields.html"><i class="fa fa-filter"></i>Filters<i class="fa fa-times-circle" style="display: none;"></i></a></li>
</ul>

<ul class="bionic-action-menu media-plan block">
    <li class="row-select"><a class=""><i class="fa fa-plus"></i>Add Placement</a></li>
    <li class="row-select"><a><i class="fa fa-gift"></i>Add Package</a></li>
    <li class="row-select"><a><i class="fa fa-road"></i>Add Roadblock</a></li>
    <li class="button-divider"></li>
    <li class="row-select disabled"><a class="open-modal" rel="modal:open" href="templates/modals/bulk-edit/bulk-edit-choose-fields.html"><i class="fa fa-pencil"></i>Edit</a></li>
    <li class="row-select disabled"><a class="open-modal" href="templates/modals/move/move1.html" rel="modal:open"><i class="fa fa-external-link"></i>Move</a></li>
    <li class="row-select disabled"><a><img src="../planner/images/bucket.svg"> Color</a></li>
    <li class="row-select disabled"><a><i class="fa fa-clone"></i>Clone</a></li>
    <li class="row-select">
        <a class="has-menu disabled"><i class="fa fa-check"></i>Authorization</a>
        <ul class="menu view-menu">
            <li class="row-select"><a><i class="fa fa-check"></i>Authorize</a></li>  
            <li class="row-select"><a><i class="fa fa-paper-plane"></i>Request Authorization</a></li>    
            <li class="row-select"><a><i class="fa fa-file-text"></i>Mark as Draft</a></li>    
            <li class="row-select"><a><i class="fa fa-ban"></i>Reject</a></li>    
        </ul>
    </li>    
    <li class="row-select disabled"><a><i class="fa fa-calendar-plus-o"></i>Add Tasks</a></li>
    <li class="row-select disabled"><a><i class="fa fa-trash"></i>Delete</a></li>
</ul>


<div class="mediaplan fixedTable block" id="mediaplan">
  
  <table class="mediaPlanFirstColumnHeader">
      <thead style="background: #f5f6f7">

      <tr class="group-members">
          <th class="col-checkbox" style=""></th><th class="col-line-number"><span class="header">Line</span></th><th class="col-placement-name divider-right"><span class="header"><a>Placement Name</a></span></th>
      </tr>
      </thead>
      
  </table>  
  
  <div class="location" style="position: fixed; margin-left: 300px; margin-top: 1px; padding:3px 1px 3px 5px; z-index: 1; background: #f5f6f7; font-weight: bold;">
      <span></span>
  </div>   
    
  <header class="fixedTable-header block">
    <table class="table table-bordered">
        <thead style="background: #f5f6f7">
            
        <tr class="group">
<th colspan="7" style="width:1352px" ><span></span></th><th colspan="10" style="width:1650px" class="divider divider-costs"><span>Costs </span></th><th colspan="7" style="width: 820px" class="divider divider-ratings"><span>Audience</span></th><th colspan="3" style="width: 570px;" class="divider divider-tasks"><span>Tasks</span></th><th colspan="2" style="width: 800px;" class="divider divider-implementation"><span>URLs for Implementation</span></th><th colspan="6" style="width: 750px;" class="divider divider-kpis"><span>KPIs</span></th><th colspan="3" style="width: 450px" class="divider divider-kpis"><span>Picklists</span></th><th colspan="3" style="width: 100%" class="divider divider-kpis"><span>Notes & History</span></th>
        </tr>
        
        <tr class="group-members"><!-- Basics --><th class="col-id"><span>Bionic ID</span></th><th class="col-program"><span><a>Program</a> / <a>Vendor</a></span></th><th class="col-product"><span><a>Product</a> / <a>Targeting</a></span></th><th class="col-channel"><span><a>Channel</a> / <a>Ad Unit</a> / <a>Ad Specs</a></span></th><th class="col-flight-dates"><span><a>Flight Dates</a> / <a>Day Parts</a></span></th><th class="col-rate center"><span>Rate</span></th><th class="col-quantity right "><span><a>Quantity</a></span></th><!-- Costs --><th class="divider divider-costs col-gross-media col-cost right"><span><a>Gross Media Cost</a></span></th><th class="col-costs col-net-media col-cost right"><span><a>Net Media Cost</a></span></th><th class="col-costs col-net-media col-cost right"><span><a>Optimization</a></span></th><th class="col-costs col-net-media col-cost right"><span><a>Talent</a></span></th><th class="col-costs col-net-media col-cost right"><span><a>Tech Fee</a></span></th><th class="col-costs col-agency-comp col-cost right"><span><a>Agency Comp</a></span></th><th class="col-costs col-total-media-cost col-cost right"><span><a>Total Media Cost</a></span></th><th class="col-costs col-ad-serving col-cost right"><span><a>Ad Serving</a></span></th><th class="col-costs col-ad-serving col-cost right"><span><a>Rich Media Ad Serving</a></span></th><th class="col-costs col-total-cost  col-cost right"><span><a>Total Cost</a></span></th><th class="col-150 col-media-bucket"><span><a>Bucket</a></span></th><th class="col-media-authorization"><span><a>Authorization</a> / <a>Authorizer</a></span></th><!-- Audience --><th class="divider col-ratings col-180"><span><a>Market & Demographics</a></span></th><th class="col-ratings col-120 "><span><a>Population</a></span></th><th class="col-ratings col-120"><span><a>Impressions</a></span></th><th class="col-ratings col-90"><span><a>CPM</a></span></th><th class="col-ratings col-90 "><span><a>Reach #</a></span></th><th class="col-ratings col-90 "><span><a>Reach %</a></span></th><th class="col-ratings col-90 "><span><a>Frequency</a></span></th><!-- Tasks --><th class="divider col-tasks "><span><a>Get Creative Assets</a></span></th><th class="col-tasks "><span><a>Get Advertiser Approval</a></span></th><th class="col-tasks "><span><a>Send Report</a></span></th><!-- Implementation --><th class="divider col-implementation col-350 "><span><a>Landing Page URL</a></span></th><th class="col-implementation col-450"><span><a>Google Analytics Tracking URL</a></span></th><!-- KPIs --><th class="divider col-kpi-cost right"><span><a>CPM</a></span></th><th class="col-kpi-number right"><span><a>Impressions</a></span></th><th class=" col-kpi-cost right"><span><a>CPC</a></span></th><th class="col-kpi-number right"><span><a>Clicks</a></span></th><th class=" col-kpi-cost right"><span><a>/View</a></span></th><th class="col-kpi-number right"><span><a>Views</a></span></th><!-- Picklists --><th class="divider col-picklists "><span><a>Picklist 1</a></span></th><th class="col-picklists "><span><a>Picklist 2</a></span></th><th class="col-picklists "><span><a>Picklist 3</a></span></th><!-- Notes & History --><th class="divider col-50 col-notes "><span><a>Notes</a></span></th><th class="col-135 col-notes "><span><a>Created</a></span></th><th class="col-135 col-notes "><span><a>Last Updated</a></span></th></tr>
        </thead>
    </table>
  </header>
  <aside class="fixedTable-sidebar block">
    <table class="table table-bordered mediaplan" id="MediaPlanFirstColumns">
        <tbody></tbody>
    </table>
<!--
    <div class="" style="width: 800px; position: fixed;margin:20px;">
        <a class="blue-button">Add Placement</a>
        <a class="gray-button">Add Package</a>
        <a class="gray-button">Add Roadblock</a>
    </div>
-->
    <style>
        .mediaplan-nav {
            position: fixed;
            display: block;
            z-index: 1;
            margin: 0 auto;
            text-align: center;
            bottom: 0;
        }
        
        .mediaplan-nav ul {
/*             margin: 0 auto; */
            
        }
        
        .mediaplan-nav li {
            float: left;
            background: #f5f6f7;
            padding: 8px;
            font-size: 11px;
            cursor: pointer;
            text-align: center;
/*             color: #9b9b9b; */
            border: 1px solid #cfcfcf;
            border-collapse: collapse;
            margin-right: -1px;
            width: 20px;
        }
        
        .mediaplan-nav li span {
            display: none;
        }
        
        .mediaplan-nav li.current {
            color: #333;
            background: linear-gradient(#cfcfcf,#e9ebed);
            border-radius: 2px;
        }
        
        .mediaplan-nav li.current span {
            font-weight: bold;
        }
        
        .mediaplan-nav li i {
            clear: both;
            display: block;
            font-size: 12px;
/*             color: #6EB3D6; */
        }
        
        .mediaplan-nav li.current i {
            color: #333;
            
        } 

        
    </style>
        <div class="mediaplan-nav">
            <ul>
                <li class="basics current" rel="0"><i class="fa fa-table"></i><span>Basics</span></li>
                <li class="costs" rel="1355"><i class="fa fa-money"></i><span>Costs</span></li>
                <li class="ratings" rel="3003"><i class="fa fa-users"></i><span>Audience</span></li>
                <li class="tasks" rel="3823"><i class="fa fa-calendar-plus-o"></i><span>Tasks</span></li>
                <li class="implementation" rel="4393"><i class="fa fa-code"></i><span>URLs</span></li>
                <li class="kpis" rel="5193"><i class="fa fa-bar-chart"></i><span>KPIs</span></li>
                <li class="picklists" rel="5943"><i class="fa fa-list"></i><span>Picklists</span></li>
                <li class="notes" rel="5943"><i class="fa fa-file-text-o"></i><span>Notes</span></li>
            </ul>
        </div>
  </aside>
  
  <div class="fixedTable-body block">
    <table class="table table-bordered mediaplan" id="MediaPlanBody">
        <tbody></tbody>
    </table>
  
  </div>
    
</div>

<script type="text/javascript" src="templates/campaign/nav-campaign.js"></script>

<script type="text/javascript">

      setCampaignInfo();
      
      var mediaPlanTab = "MediaPlan2";
      
      $(document).ready( function() {
                    
            $("#bionic-main").click(function () {
//                 $(".menu").hide();
            });
            
            $(".columnMenuButton").click(function () {
                $(".menu").toggle();
            });

            $(".mediaplan-nav li ").click(function () {
                $($location).text("");
                var scrollDistance =  $(this).attr('rel');
                $('.fixedTable-body').animate({scrollLeft:scrollDistance});
            });
            
            $(".hasDropdown").bind("click",function(e){
                
                $(this).removeClass("disabled");
                $(this).next(".menu").toggle();
                return false;
                
            });
            
            
            $(".mode").bind("click",function(e){
                
                $(".menu").hide();
                
                $(".bionic-mode-menu").addClass("on");
                $(".bionic-mode-menu span").text("Media Authorization");
                $(".bionic-mode-menu .fa-times-circle").show();

                $(".bionic-columns-menu").addClass("on");
                $(".bionic-columns-menu span").text("52 Columns Hidden");
                $(".bionic-columns-menu .fa-times-circle").show();

                $(".bionic-filters-menu").addClass("on");
                $(".bionic-filters-menu span").text("Filtered");
                $(".bionic-filters-menu .fa-times-circle").show();

                $(".group th").hide();
                $(".group .divider-costs").show();
                
                $(".location span").text("Costs");


                $(".col-id").hide();
                $(".col-program").hide();
                $(".col-product").hide();
                $(".col-channel").hide();
                $(".col-flight-dates").hide();
                $(".col-rate").hide();
                $(".col-quantity").hide();
                $(".col-gross-media").hide();
                $(".col-net-media").hide();
                $(".col-costs").hide();
                $(".col-cost").hide();
                $(".col-ratings").hide();
                $(".col-tasks").hide();
                $(".col-implementation").hide();
                $(".col-kpi").hide();
                $(".col-kpi-cost").hide();
                $(".col-kpi-number").hide();
                $(".col-picklists").hide();
                $(".col-notes").hide();
                
                $(".col-total-cost").show();
                $(".col-bucket").show();
                                
                return false;
                
            });
            
            $(".bionic-mode-menu .fa-times-circle").bind("click",function(e){
                $(".bionic-mode-menu").removeClass("on");
                $(".bionic-mode-menu span").text("View");
                $(".bionic-mode-menu .fa-times-circle").hide();
                $(".bionic-columns-menu").removeClass("on");
                $(".bionic-columns-menu span").text("View");
                $(".bionic-columns-menu .fa-times-circle").hide();
                $(".bionic-filters-menu").removeClass("on");
                $(".bionic-filters-menu span").text("View");
                $(".bionic-filters-menu .fa-times-circle").hide();
                $(".menu").hide();
                
                $(".col-id").show();
                $(".col-program").show();
                $(".col-product").show();
                $(".col-channel").show();
                $(".col-flight-dates").show();
                $(".col-rate").show();
                $(".col-quantity").show();
                $(".col-gross-media").show();
                $(".col-net-media").show();
                $(".col-costs").show();
                $(".col-cost").show();
                $(".col-ratings").show();
                $(".col-tasks").show();
                $(".col-implementation").show();
                $(".col-kpi").show();
                $(".col-kpi-cost").show();
                $(".col-kpi-number").show();
                $(".col-picklists").show();
                $(".col-notes").show();
                
                return false;
            });
            
            $("th.col-program").bind("contextmenu",function(e){
                
/*
                $(".menu").toggle();
                return false;
*/
                
            });
            
            // Handle closing menus
            
            $("body").click(function () {        
        
                $(".menu").hide();
                $(".performance-details").hide();
        
            });
        
            $(".bionic-filter").click(function (event) {        
                event.stopPropagation();
                $(".menu").hide();
                $(this).next(".menu").show();
            });
            
            $(".menu").click(function (event) {        
                event.stopPropagation();
            });
            
            // Load Data from Google Sheet

        Tabletop.init( { key: public_spreadsheet_url,
                         callback: showInfo,
                         wanted: [ mediaPlanTab ],
                        // query:["state=done and (name=performance or name=flowchart)"],
                         debug: true } )      
      })
        
      function showInfo(data, tabletop) {

        $.each( tabletop.sheets(mediaPlanTab).all(), function(i, item) {
          var rowNumber = item.RowNumber;
          var isFlightMember = '',
              flightHeader='', 
              flightMember ='', 
              flightHeaderImage='',
              flightMemberImage='';
          
          if(item.FlightedPlacement){
              flightHeader = 'flightHeader flight'+flightHeader;
              flightHeaderImage = '<img class="flightheader" src="../images/flight-header-open.svg" />';
          }

          if(item.FlightMember){
              isFlightMember = "flight"+item.FlightMember;
              flightMember = 'flightMember flight'+flightMember;
              flightMemberImage = '<img class="flightmember" src="../images/flight-member.svg" />';
          }

          if(item.CostOptimization == ''){
              var excludeCostOptimization = "exclude inactive";
          }
          if(item.CostTalent == ''){
              var excludeCostTalent = "exclude inactive";
          }
          if(item.CostTechFee == ''){
              var excludeCostTechFee = "exclude inactive";
          }

// Itemized Costs

          var costActions = '<div class="actions exclude-reset"><a class="action exclude" id="actionExcludeCPM'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'" data-item="'+i+'" data-action="exclude" data-kpi="CPM" data-target="kpiCPM'+i+'">Exclude</a> <a  class="action reset" style="display:none" id="actionResetCPM'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'" data-item="'+i+'" data-action="reset" data-kpi="CPM" data-default="'+item.CPMdefault+'" data-numberdefault="'+item.ImpressionsDefault+'" data-target="kpiCPM'+i+'">Reset</a> <a data-action="edit" class="action cost-edit">Edit</a></div><div class="inline_edit "></div>';

          var netMediaCost      = "";
          var grossMediaCost    = "";
          var totalCost         = "";
          

// KPI Actions
          
          var customCPM, customCPC, customCPV;
          var kpiActionsCPM = '<div class="actions exclude-reset"><a class="action exclude" id="actionExcludeCPM'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'" data-item="'+i+'" data-action="exclude" data-kpi="CPM" data-target="kpiCPM'+i+'">Exclude</a> <a  class="action reset" style="display:none" id="actionResetCPM'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'" data-item="'+i+'" data-action="reset" data-kpi="CPM" data-default="'+item.CPMdefault+'" data-numberdefault="'+item.ImpressionsDefault+'" data-target="kpiCPM'+i+'">Reset</a></div>';
              kpiActionsCPC = '<div class="actions exclude-reset"><a class="action exclude" id="actionExcludeCPC'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'" data-item="'+i+'" data-action="exclude" data-kpi="CPC" data-target="kpiCPC'+i+'">Exclude</a> <a  class="action reset" style="display:none" id="actionResetCPC'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'" data-item="'+i+'" data-action="reset" data-kpi="CPC" data-default="'+item.CPCdefault+'" data-numberdefault="'+item.ClicksDefault+'" data-target="kpiCPC'+i+'">Reset</a></div>';
              kpiActionsCPV = '<div class="actions exclude-reset"><a class="action exclude" id="actionExcludeCPV'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'" data-item="'+i+'" data-action="exclude" data-kpi="CPV" data-target="kpiCPV'+i+'">Exclude</a> <a  class="action reset" style="display:none" id="actionResetCPV'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'" data-item="'+i+'" data-action="reset" data-kpi="CPV" data-default="'+item.CPVdefault+'" data-numberdefault="'+item.ViewsDefault+'" data-target="kpiCPV'+i+'">Reset</a> </div>';
          
          if(item.CPM == item.CPMdefault){
              customCPM = "";
          } else {
              customCPM = "custom";
              kpiActionsCPM = '<div class="actions exclude-reset"><a class="action exclude" id="actionExcludeCPM'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'"  data-item="'+i+'" data-action="exclude" data-kpi="CPM" data-target="kpiCPM'+i+'">Exclude</a> <a  class="action reset" id="actionResetCPM'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'" data-item="'+i+'" data-action="reset" data-kpi="CPM" data-default="'+item.CPMdefault+'"  data-numberdefault="'+item.ImpressionsDefault+'" data-target="kpiCPM'+i+'">Reset</a> </div>';
          }

          if(item.CPC == item.CPCdefault){
              customCPC = "";
          } else {
              customCPC = "custom";
              kpiActionsCPC = '<div class="actions exclude-reset"> <a class="action exclude" id="actionExcludeCPC'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'"  data-item="'+i+'" data-action="exclude" data-kpi="CPC" data-target="kpiCPC'+i+'">Exclude</a> <a  class="action reset" id="actionResetCPC'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'" data-item="'+i+'" data-action="reset" data-kpi="CPC" data-default="'+item.CPCdefault+'" data-numberdefault="'+item.ClicksDefault+'" data-target="kpiCPC'+i+'">Reset</a></div>';
          }
          
          if(item.CPV == item.CPVdefault){
              customCPV = "";
          } else {
              customCPV = "custom";
              kpiActionsCPV = '<div class="actions exclude-reset"><a class="action exclude" id="actionExcludeCPV'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'" data-item="'+i+'" data-action="exclude" data-kpi="CPV" data-target="kpiCPV'+i+'">Exclude</a> <a class="action reset" id="actionResetCPV'+i+'" data-flightheader="'+item.FlightedPlacement+'" data-flightmember="'+item.FlightMember+'" data-item="'+i+'" data-action="reset" data-kpi="CPV" data-default="'+item.CPVdefault+'" data-numberdefault="'+item.ViewsDefault+'" data-target="kpiCPV'+i+'">Reset</a></div>';
          }
             
          
//           mediaPlanFirstColumns.append('<td class="td-checkbox">'+ '<input type="checkbox"> ' +'</td>');   
          var mediaPlanFirstColumns = $('<tr class="'+flightHeader+' '+isFlightMember+'">');
          
          // Basics
          
          mediaPlanFirstColumns.append('<td class="col-checkbox">'+ ' ' +'</td>');          
          mediaPlanFirstColumns.append('<td class="col-line-number"><span>' + rowNumber + flightHeaderImage+flightMemberImage+'</span></td>');
//           mediaPlanFirstColumns.append('<td class="col-placement-name divider-right"><a href="#/line/overview/">'+ item.PlacementName +'</a></td>');
          mediaPlanFirstColumns.append('<td class="col-placement-name divider-right"><a class="open-modal" rel="open:modal" href="templates/modals/line/line-item-overview.html">'+ item.PlacementName +'</a></td>');
          mediaPlanFirstColumns.append('</tr>');
          mediaPlanFirstColumns.appendTo("#MediaPlanFirstColumns tbody");
                    
          var mediaPlanBody = $('<tr id="row'+rowNumber+'" class="'+flightHeader+' '+isFlightMember+'"><td class="col-id readonly"><span>' + item.BionicID + '</span></td>');
          mediaPlanBody.append('<td class="col-program"><input type="text" value="'+ item.Program +'"><span class="vendor">'+ item.Vendor +'</span></td>');
          mediaPlanBody.append('<td class="col-product"><input type="text" value="'+ item.Product +'"><input class="secondary" type="text" value="'+ item.Targeting +'"></td>');
          mediaPlanBody.append('<td class="col-channel"><input class="half" type="text" value="'+ item.Channel +'"><input class="half" type="text" value="'+ item.AdUnit +'"><input class="secondary" type="text" value="'+ item.AdSpecs +'"></td>');
          mediaPlanBody.append('<td class="col-flight-dates"><input class="half" type="text" value="'+ item.StartDate +'"><input class="half" type="text" value="'+ item.EndDate +'"><input class="half secondary" type="text" value="Every Day"><input class="secondary half" type="text" value="All Day"></td>');
          mediaPlanBody.append('<td class="col-rate"><input class="currency" type="text" value="'+item.RateCurrency+'"><input class="number" type="text" value="'+item.RateAmount+'"><input type="text" value="'+item.RateType+'"><input type="text" value="'+item.GrossOrNetOrTotal+'"></td>');
          mediaPlanBody.append('<td class="col-quantity"><input type="text" value=""></input></td>');
          
          // Costs
          
          mediaPlanBody.append('<td class="divider col-gross-media col-cost"><span class="currency-symbol">$</span><a>1,000.00</a></td>');
          mediaPlanBody.append('<td class="col-net-media col-cost"><span class="currency-symbol">$</span><a>1,000.00</a></td>');
          mediaPlanBody.append('<td class="col-kpi col-production-cost col-cost '+ excludeCostOptimization +'"><div class="actions readonly-amount"><span class="currency-symbol">$</span><a data-action="edit">'+item.CostOptimization+'</a></div>'+costActions+'</td>');
          mediaPlanBody.append('<td class="col-kpi col-production-cost col-cost '+excludeCostTalent+'"><div class="actions readonly-amount"><span class="currency-symbol">$</span><a data-action="edit">'+item.CostTalent+'</a></div>'+costActions+'</td>');
          mediaPlanBody.append('<td class="col-kpi col-production-cost col-cost '+excludeCostTechFee+'"><div class="actions readonly-amount"><span class="currency-symbol">$</span><a data-action="edit">'+item.CostTechFee+'</a></div>'+costActions+'</td>');
          mediaPlanBody.append('<td class="col-agency-comp col-cost"><span class="currency-symbol">$</span><a>1,000.00</a></td>');
          mediaPlanBody.append('<td class="col-total-media-cost col-cost"><span class="currency-symbol">$</span><a>1,000.00</a></td>');
          mediaPlanBody.append('<td class="col-kpi col-delivery-dcm col-cost"><div class="readonly-amount"><span class="currency-symbol">$</span><input id="views'+ i + '" class="right number kpiCPV'+i + '" type="text" value="250.00"></div>'+kpiActionsCPM+'</td>');
          mediaPlanBody.append('<td class="col-kpi col-delivery-rich-media col-cost"><div class="readonly-amount"><span class="currency-symbol">$</span><input id="views'+ i + '" class="right number kpiCPV'+i + '" type="text" value="250.00"></div>'+kpiActionsCPM+'</td>');

          mediaPlanBody.append('<td class="col-total-cost col-cost"><span class="currency-symbol">$</span><a class="">1,000.00</a></td>');     
          
          // Buckets
               
          mediaPlanBody.append('<td class="col-bucket col-cost"><input type="text" class="has-menu" value="'+item.Bucket+'"><ul class="menu view-menu media-plan-input-menu buckets"><li><a>Digital '+progressBar(30,100)+'</a></li><li><a>Digital '+progressBar(30,100)+'</a></li><li><a>Digital '+progressBar(40,100)+'</a></li><li><a>Digital</a></li></ul><i class="dropdown fa fa-caret-down"></i></td>');          

          // Authorization
          
          mediaPlanBody.append('<td class="col-media-authorization col-dropdown"><input class="half has-menu" style="float: none;" type="text" value=""><ul class="menu view-menu media-plan-input-menu authorization-actions"><li><a open-modal" rel="modal:open" href="templates/modals/authorization/request.html"><i class="fa fa-paper-plane"></i> Pending</a></li><li><a open-modal" rel="modal:open" href="templates/modals/authorization/authorize.html"><i class="fa fa-check"></i> Authorized</a></li><li><a><i class="fa fa-file-text"></i> Draft</li></a><li><a open-modal" rel="modal:open" href="templates/modals/authorization/reject.html"><i class="fa fa-ban"></i> Rejected</a></li></ul><i class="dropdown fa fa-caret-down"></i></td>');          
          
          
          // Ratings
          
          mediaPlanBody.append('<td class="divider col-ratings col-180"> </td>');
          mediaPlanBody.append('<td class=" col-ratings col-120"> </td>');
          mediaPlanBody.append('<td class=" col-ratings col-120"> </td>');
          mediaPlanBody.append('<td class=" col-ratings col-90"> </td>');
          mediaPlanBody.append('<td class=" col-ratings col-90"> </td>');
          mediaPlanBody.append('<td class=" col-ratings col-90"> </td>');
          mediaPlanBody.append('<td class=" col-ratings col-90"> </td>');

          // Tasks
          
          mediaPlanBody.append('<td class="divider col-tasks"> </td>');
          mediaPlanBody.append('<td class=" col-tasks"> </td>');
          mediaPlanBody.append('<td class=" col-tasks"> </td>');
          
          
          // Implementation
          
          mediaPlanBody.append('<td class="divider col-implementation col-350"> </td>');
          mediaPlanBody.append('<td class=" col-implementation col-450"> </td>');
          
          // KPIs
          
          mediaPlanBody.append('<td class="divider CPM CPM'+ i +' '+isFlightMember+ ' col-kpi-cost"><span class="currency-symbol">$</span><input data-kpi="impressions'+ i + '" class="right cpw CPM kpiCPM'+ i + ' '+customCPM+'" type="text" value="'+ item.CPM +'">'+kpiActionsCPM+'</td>');
          mediaPlanBody.append('<td class="CPM CPM'+ i +' '+isFlightMember+ ' col-kpi-number"><input id="impressions'+ i + '" class="right number kpiCPM'+ i +'" type="text" value="'+ item.Impressions +'"></td>');
          mediaPlanBody.append('<td class="CPC CPC'+ i +' '+isFlightMember+ ' col-kpi-cost "><span class="currency-symbol">$</span><input data-kpi="clicks'+ i + '" class="right cpw CPC kpiCPC'+i + ' '+customCPC+'" type="text" value="'+ item.CPC +'">'+ kpiActionsCPC +'</td>');
          mediaPlanBody.append('<td class="CPC CPC'+ i +' '+isFlightMember+ ' col-kpi-number"><input id="clicks'+ i + '" class="right number kpiCPC'+i + '" type="text" value="'+ item.Clicks +'"></td>');
          mediaPlanBody.append('<td class="CPV CPV'+ i +' '+isFlightMember+ ' col-kpi-cost "><span class="currency-symbol">$</span><input  data-kpi="views'+ i + '" class="right cpw CPV kpiCPV'+i + ' '+customCPV+'" type="text" value="'+ item.CPV +'">'+kpiActionsCPV+'</td>');
          mediaPlanBody.append('<td class="CPV CPV'+ i +' '+isFlightMember+ ' col-kpi-number"><input id="views'+ i + '" class="right number kpiCPV'+i + '" type="text" value="'+ item.Views +'"></td>');
          
          // Picklists
          
          mediaPlanBody.append('<td class="divider col-picklists"> </td>');
          mediaPlanBody.append('<td class=" col-picklists"> </td>');
          mediaPlanBody.append('<td class=" col-picklists"> </td>');

          // Notes & History
          
          mediaPlanBody.append('<td class=" col-50 divider col-notes"> </td>');
          mediaPlanBody.append('<td class=" col-135 col-notes"> </td>');
          mediaPlanBody.append('<td class=" col-135 col-notes"> </td>');
          
          mediaPlanBody.append('</tr>');
          mediaPlanBody.appendTo("#MediaPlanBody tbody");
        })

        // Cell Actions
        $(".actions a").click(function(event){
//         $(document).on('click', '.exclude-reset a', function() {
            var action = $(this).data('action');
            var actionButton = $(this).attr('id');
            var item = $(this).data('item');
            var kpi = $(this).data('kpi');
            var target = $(this).data('target');
            var kpidefault = $(this).data('default');
            var numberdefault = $(this).data('numberdefault');
            var numberdefaultline = "100,000";
            var flightheader =  $(this).data('flightheader');
            var flightmember =  $(this).data('flightmember');
            
            console.log(action);
            
            if(action == "exclude") {
                
                if(flightheader > 0){
                    $("tr.flight"+flightheader+" td input."+kpi).val("");
                    $("tr.flight"+flightheader+" td input."+kpi).removeClass("custom");
                    $("tr.flight"+flightheader+" td input."+kpi).parent().addClass("inactive");
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader).addClass("inactive");
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader+" input").addClass("inactive");
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader+" input").val("");
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader).find(".currency-symbol").hide();
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader).find(".action.exclude").hide();
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader).find(".action.reset").show();
                }
                
                $(this).parent().parent().find(".currency-symbol").hide();
                $("."+target).val("");
                $("."+target).removeClass("custom");
                $("#actionExclude"+kpi+item).hide();
                $("#actionReset"+kpi+item).show();
                $("td."+kpi+item).addClass("inactive");
                $("."+target).addClass("inactive");
                
            } else if(action == "reset") {
                
                if(flightheader > 0){
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader).removeClass("inactive");
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader+" input").removeClass("inactive");
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader+" input.cpw").val(kpidefault);
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader+" input.number").val(numberdefaultline);
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader).find(".currency-symbol").show();
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader).find(".action.exclude").show();
                    $("tr.flight"+flightheader+" td."+kpi+".flight"+flightheader).find(".action.reset").hide();
                }
                
                $(".cpw.kpi"+kpi+item).val(kpidefault);
                $(".number.kpi"+kpi+item).val(numberdefault);
    //             $(".number.kpi"+kpi+item).val("");
                $("."+target).removeClass("custom");
                $("."+target).removeClass("inactive");
                $("td."+kpi+item).removeClass("inactive");
                $("#actionReset"+kpi+item).hide();
                $("#actionExclude"+kpi+item).show();
                $(this).parent().parent().find(".currency-symbol").show();
            
            } else if(action == "edit") {
    //             var inlineEdit = $(event.target).find('.inline_edit');
    //             console.log(inlineEdit);
                $(".inline_edit").hide();
                $(event.target).closest("td").find('.inline_edit').load("templates/campaign/mediaplan-inline-cost-edit.html");
                $(event.target).closest("td").find('.inline_edit').toggle();
            }
                    
        });
        
        
        // Budget 
                
        // Authorizations

            $(document).on('click', '.has-menu', function() {
                $(this).next(".menu").show();
            });
            
          $(".authorization-actions a").click(function(){
              $(document).on($.modal.OPEN, function(event, modal) {
                $("#row1 td input.authorization-menu").val("Authorized");
                  
//                  $(".modal h1").html("change");
              });
          });


      }
</script>
        
<script type="text/javascript">
    
    $("body").click(function () {      
        $(".inline_edit, .actions a").click(function (event) {        
            event.stopPropagation();
        });          

        $(".inline_edit").hide();
    });

    // ------------------------------------------------
    // Set Up the Fixed First Column Table

    (function() {
      var mediaplan, fixedTable;
    
      fixedTable = function(el) {
        var $body, $header, $sidebar, $label;
        $body = $(el).find('.fixedTable-body');
        $sidebar = $(el).find('.fixedTable-sidebar table');
        $header = $(el).find('.fixedTable-header table');
        $location = $(el).find('.location span');
        $($location).text("Basics ");
        return $($body).scroll(function() {
          $($sidebar).css('margin-top', -$($body).scrollTop());
          if(($($body).scrollLeft() > 0)&&$($body).scrollLeft() < 1245){ 
              $($location).text("Basics ");
               $(".mediaplan-nav li").removeClass("current");
               $(".mediaplan-nav li.basics").addClass("current");
          }
          
          if(($($body).scrollLeft() > 1245)&&$($body).scrollLeft() < 1354){ 
              $($location).text(" ");
          }

          if(($($body).scrollLeft() > 1354)&&$($body).scrollLeft() < 3050){ 
              $($location).text("Costs");
               $(".mediaplan-nav li").removeClass("current");
               $(".mediaplan-nav li.costs").addClass("current");
          }

          if(($($body).scrollLeft() > 3050)&&$($body).scrollLeft() < 3002){ 
              $($location).text(" ");
          }
          
          if(($($body).scrollLeft() > 3002)&&$($body).scrollLeft() < 3824){ 
              $($location).text("Audience");
               $(".mediaplan-nav li").removeClass("current");
               $(".mediaplan-nav li.ratings").addClass("current");
          }
          
          if(($($body).scrollLeft() > 3824)&&$($body).scrollLeft() < 3920){ 
              $($location).text("");
          }
          
          if(($($body).scrollLeft() > 3920)&&$($body).scrollLeft() < 4410){ 
              $($location).text("Tasks");
               $(".mediaplan-nav li").removeClass("current");
               $(".mediaplan-nav li.tasks").addClass("current");
          }

          if(($($body).scrollLeft() > 4410)&&$($body).scrollLeft() < 4492){ 
              $($location).text("");
          }

          if(($($body).scrollLeft() > 4492)&&$($body).scrollLeft() < 5150){ 
              $($location).text("URLs for Implementation");
               $(".mediaplan-nav li").removeClass("current");
               $(".mediaplan-nav li.implementation").addClass("current");
          }
          
          if(($($body).scrollLeft() > 5150)&&$($body).scrollLeft() < 5293){ 
              $($location).text("");
          }

          if(($($body).scrollLeft() > 5293)&&$($body).scrollLeft() < 8000){ 
              $($location).text("KPIs");
               $(".mediaplan-nav li").removeClass("current");
               $(".mediaplan-nav li.kpis").addClass("current");
          }
/*
          if(($($body).scrollLeft() > 1200)&&$($body).scrollLeft() < 2400){ 
              $($location).text("Picklists" + $($body).scrollLeft());
          }
*/
          
          return $($header).css('margin-left', -$($body).scrollLeft());
        });
      };
    
      mediaplan = new fixedTable($('#mediaplan'));
    
    }).call(this);

    // ------------------------------------------------
    // Make the rows highlight with Fixed First Column   
    
    $(document).on({
    mouseenter: function () {
    var trIndex = $(this).index();
    $("table.mediaplan").each(function(index) {
        $(this).find("tbody>tr:eq("+trIndex+")").addClass("hover")
    });
    },
    mouseleave: function () {
    var trIndex = $(this).index();
    $("table.mediaplan").each(function(index) {
        $(this).find("tbody>tr:eq("+trIndex+")").removeClass("hover")
    });
    }
    }, "#mediaplan table tbody tr");
    
    // ------------------------------------------------
    
    
    $(document).on('change', '.cpw', function(){
        var kpi = $(this).data('kpi');
        var item = $(this).data('item');
            $(this).parent().removeClass("inactive");   
            $("#"+kpi).removeClass("inactive");             
            $("#"+kpi).parent().removeClass("inactive");             
            $(this).addClass("custom"); 
            $(this).parent().find(".actions a").show();               
    });
    
</script>    

<script>
    $(".bionic-filter").click(function (event) {        
        event.stopPropagation();
        $(".menu").hide();
        $(this).next(".menu").show();
    });
    
    $(".menu").click(function (event) {        
        event.stopPropagation();
    });

</script>